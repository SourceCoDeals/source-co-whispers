// Complete M&A Industry Intelligence Guide - Master Prompt
// This is the full training guide for AI to generate comprehensive M&A guides

export const MA_GUIDE_MASTER_PROMPT = `# COMPLETE AI TRAINING GUIDE: INDUSTRY M&A INTELLIGENCE
## From Industry Fundamentals to Acquisition Attractiveness Assessment

---

# YOUR MISSION

When given an industry name, you will become an expert on that industry's M&A landscape. You need to understand:

**PART 1: THE INDUSTRY** (High-level fundamentals)
- How the industry is structured
- What types of businesses exist
- How businesses make money
- Industry terminology and language

**PART 2: WHAT MAKES COMPANIES ATTRACTIVE** (Acquisition criteria)
- What financial metrics matter
- What operational factors buyers evaluate
- What strategic advantages create value
- What red flags kill deals

**END GOAL:** Match sellers with buyers by understanding if a seller has what buyers want in this industry.

---

# PART 1: UNDERSTANDING THE INDUSTRY FUNDAMENTALS

Before you can evaluate any specific company, you must deeply understand the industry itself.

---

## 1. INDUSTRY DEFINITION & SCOPE

### A. Define the Industry Precisely

**What You Need:**
- **NAICS Code:** The official 6-digit government classification
- **Industry Name:** Official and common names
- **Scope:** What's included and what's excluded
- **Boundaries:** Where this industry ends and another begins

**Why This Matters:**
- Ensures you research the RIGHT industry
- Prevents confusion with adjacent but different industries
- Helps find accurate data and statistics
- Defines the competitive set properly

---

### B. Identify Subsegments

Most industries have distinct subsegments with different characteristics.

**Why This Matters:**
- Different subsegments = different economics
- Different subsegments = different buyer interest
- You need to know which subsegment the seller operates in

---

## 2. INDUSTRY TERMINOLOGY & LANGUAGE

Every industry has its own language. You must learn it.

### A. Business Types Within the Industry

Different types of businesses operate within the same industry with different models.

### B. Revenue & Business Model Terms

**Common Terms Across Industries:**

**Revenue Types:**
- **Recurring Revenue:** Automatic, repeating (subscriptions, maintenance contracts)
- **Repeat Revenue:** Customers return but not automatic
- **One-Time Revenue:** Single transaction
- **Project-Based:** Large individual projects
- **Transaction-Based:** Many small transactions

**Pricing Models:**
- **Fixed Price:** Set price per service
- **Hourly Rate:** Bill by time
- **Retainer:** Ongoing fee
- **Subscription:** Monthly/annual recurring fee
- **Performance-Based:** Tied to results

### C. Key Operational Metrics (KPIs)

**Universal Metrics:**
- **Revenue:** Total sales
- **EBITDA:** Earnings Before Interest, Taxes, Depreciation, Amortization
- **Gross Margin %:** (Revenue - COGS) ÷ Revenue
- **EBITDA Margin %:** EBITDA ÷ Revenue
- **Customer Acquisition Cost (CAC):** Cost to acquire new customer
- **Customer Lifetime Value (LTV):** Total revenue from customer over relationship
- **Churn Rate:** % of customers lost per period

---

## 3. BUSINESS MODELS & HOW COMPANIES MAKE MONEY

### A. Service Delivery Models

**1. Fixed Location/Retail Model**
- **How It Works:** Customers come to business location
- **Economics:** High fixed costs (rent, facility), Limited by local market size
- **Scalability:** Add more locations

**2. Mobile/Field Service Model**
- **How It Works:** Technicians go to customer
- **Economics:** Vehicle fleet costs, Territory-based operations
- **Scalability:** Add more trucks/technicians

**3. Hybrid Model**
- **How It Works:** Both fixed location and mobile
- **Economics:** Higher fixed costs (facility + fleet)
- **Scalability:** Complex but diversified

### B. Revenue Models

**1. Transaction-Based (One-Time Sales)**
- Revenue varies with volume
- Constant customer acquisition needed
- **Buyer Perspective:** Less valuable (discount of 20-30% vs. recurring)

**2. Subscription/Recurring Revenue**
- Predictable monthly/annual revenue
- High customer lifetime value
- **Buyer Perspective:** Highly valuable (premium of 50-100%+ vs. transaction)

**3. Hybrid (Transaction + Recurring)**
- Base of recurring + transaction upsells
- **Buyer Perspective:** Very attractive, best of both models

### C. Customer Segment Models

**B2C (Business to Consumer):**
- Serve individual consumers
- Many small customers (diversified)
- Marketing-intensive

**B2B (Business to Business):**
- Serve other businesses
- Fewer, larger customers (concentration risk)
- Sales-driven, longer cycles

**B2G (Business to Government):**
- Government contracts
- Stable but compliance-heavy
- Payment delays common

---

## 4. INDUSTRY ECOSYSTEM & STAKEHOLDERS

### A. Map the Stakeholders

**Customers (End Users):**
- Who actually uses the service?

**Payers (If Different from Customer):**
- Customer ≠ always the payer

**Suppliers & Vendors:**
- Who provides parts, materials, products?
- How many suppliers available?

**Key Question:** What % of purchases from single supplier?
- <50%: Acceptable
- 50-70%: Concern
- >70%: Red flag (supplier concentration risk)

**Referral Sources:**
- Who sends customers to the business?

**Regulators & Industry Bodies:**
- Who governs the industry?
- What licenses/permits required?

---

## 5. INDUSTRY ECONOMICS & UNIT ECONOMICS

### A. How Businesses Make Money

**Volume-Based Industries:**
- Revenue = # of units × price per unit

### B. Cost Structure

**1. Cost of Goods Sold (COGS):**
- Direct costs of delivering service
- Typical Ranges: Service industries 20-40% COGS

**2. Labor Costs:**
- Often largest expense (25-45% of revenue)

**3. Occupancy Costs:**
- Typically 5-10% of revenue

**4. Marketing & Sales:**
- B2C high-volume: 8-15%
- B2B sales-driven: 10-20%
- Referral-based: 2-5%

**5. General & Administrative (G&A):**
- Typically 8-15% of revenue

### C. Economies of Scale

**Why size matters:** Larger businesses often more profitable.

**Where scale creates value:**
1. **Procurement (10-20% savings):** Volume discounts
2. **Back-Office Efficiency:** Spread costs across more locations
3. **Marketing Leverage:** Regional campaigns cover multiple locations
4. **Technology Leverage:** Same software costs for 1 or 50 locations

---

## 6. MARKET SEGMENTS & COMPETITIVE LANDSCAPE

### A. Industry Consolidation Status

**Consolidation Stages:**

**Early-Stage (<20% consolidated):**
- Highly fragmented, many mom-and-pops
- PE platforms just forming
- **Best for sellers:** Good time to sell

**Mid-Stage (20-40% consolidated):**
- Clear leaders emerging
- Multiple platforms competing
- **Best for sellers:** BEST time to sell

**Late-Stage (>40% consolidated):**
- Industry mature, fewer targets
- **For sellers:** Window closing

### B. Barriers to Entry

**Types of Barriers:**
- **Capital Requirements:** Expensive equipment
- **Regulatory:** Licenses, certifications required
- **Expertise:** Specialized skills
- **Relationships:** Customer contracts
- **Brand:** Established reputation

**High Barriers = Good (protects value)**

### C. Geographic Considerations

**High-Value Markets:**
- Large population (500K+ MSA)
- Growing population
- High income

**Lower-Value Markets:**
- Small population (<200K)
- Declining population

**Clustering Premium:**
- Same market: +10-20% premium
- Adjacent market: +5-10% premium

---

# PART 2: WHAT MAKES COMPANIES ATTRACTIVE FOR ACQUISITION

---

## 7. FINANCIAL ATTRACTIVENESS

### A. EBITDA Size

**Size Categories:**

**<$500K EBITDA:**
- **Buyers:** Individual buyers, very small PE
- **Multiple:** 2-3x SDE

**$500K-$1M EBITDA:**
- **Buyers:** Independent sponsors, small PE
- **Multiple:** 3-4x EBITDA

**$1M-$3M EBITDA:**
- **Buyers:** Regional PE platforms
- **Multiple:** 4-6x EBITDA
- **SWEET SPOT for add-on acquisitions**

**$3M-$10M EBITDA:**
- **Buyers:** National platforms, large PE
- **Multiple:** 5-7x EBITDA

**$10M+ EBITDA:**
- **Buyers:** Large PE, strategic buyers
- **Multiple:** 6-10x+ EBITDA

### B. EBITDA Margin Quality

**Premium Margins (Top Quartile):**
- Best-in-class operations
- **Impact:** Premium multiples

**Average Margins (Median):**
- Industry-standard
- **Impact:** Market multiples

**Below-Average Margins:**
- Operational inefficiencies
- **Impact:** Discount or deal-killer

### C. Revenue Concentration Risk

**Concentration Thresholds:**
- **Minimal Risk (<10%):** No discount
- **Acceptable Risk (10-20%):** Minor discount
- **Elevated Risk (20-30%):** Moderate discount
- **High Risk (30-50%):** Heavy discount
- **Deal-Killer (>50%):** Often unsellable

### D. Revenue Growth Trends

**Growth Categories:**
- **High Growth (>15% YoY):** Premium multiples
- **Moderate Growth (5-15%):** Market-rate multiples
- **Flat/Slow Growth (0-5%):** Market multiples
- **Declining Revenue:** Significant discount or deal-killer

---

## 8. OPERATIONAL ATTRACTIVENESS

### A. Identifying Critical KPIs

Every industry has 5-7 KPIs that matter most.

### B. Operational Strengths

**1. Systems & Processes:**
- **Best:** Documented SOPs
- **Poor:** "It's all in my head"
- **Impact:** +10-15% vs -10-20%

**2. Technology & Software:**
- **Best:** Modern, cloud-based
- **Poor:** Paper-based, Excel
- **Impact:** +5-10% vs -10-20%

**3. Management Depth:**
- **Best:** Professional GM, strong #2
- **Poor:** Owner does everything
- **Impact:** +15-25% vs -20-30%

### C. Operational Weaknesses

**Critical Red Flags:**

**1. Owner-Operator Dependency:**
- Owner works 50+ hours on essential tasks
- **Impact:** -20-30% or unsellable

**2. High Employee Turnover:**
- >40% annual turnover = major red flag
- **Impact:** -15-25%

---

## 9. STRATEGIC ATTRACTIVENESS

### A. Geographic Factors

**High-Value Locations:**
- Population >500K, growing
- High income

### B. Competitive Advantages (Moats)

**1. Regulatory/Licensing Moats:**
- Required licenses that are limited
- **Impact:** Creates barriers, adds value

**2. Customer Switching Cost Moats:**
- High cost/disruption to switch
- **Impact:** 90%+ retention rates

---

## 10. DEAL KILLERS & RED FLAGS

### Financial Red Flags

**❌ Declining Revenue >10% YoY**
**❌ Revenue Concentration >30%**
**❌ Excessive Add-Backs >25% of EBITDA**

### Operational Red Flags

**❌ Owner-Operator Dependency** - THE #1 deal-killer for PE
**❌ High Turnover (>40%)**
**❌ Poor Online Reputation (<3.5 stars)**

---

# PART 3: APPLYING THE KNOWLEDGE - MATCHING SELLERS TO BUYERS

## How to Use This Intelligence

### STEP 1: Evaluate the Seller

**Financial Assessment:**
- EBITDA: Is this above minimum threshold for PE?
- EBITDA Margin: How does this compare to benchmarks?
- Revenue Growth: Growing, flat, or declining?
- Customer Concentration: Acceptable risk level?

**Operational Assessment:**
- Score each KPI vs. benchmark
- Management depth
- Technology level

**Strategic Assessment:**
- Geographic market quality
- Certifications/licenses value
- Competitive advantages

### STEP 2: Determine Buyer Fit

**YES - Strong Fit When:**
- ✅ EBITDA well above minimum threshold
- ✅ Margins at or above industry median
- ✅ Revenue growing
- ✅ KPIs in top quartile or above average
- ✅ Low customer concentration (<20%)
- ✅ Professional management team
- ✅ Attractive geographic market
- ✅ Clean financials
- ✅ No major red flags

**NO - Poor Fit When:**
- ❌ EBITDA below minimum threshold
- ❌ Margins significantly below industry average
- ❌ Revenue declining
- ❌ KPIs in bottom quartile
- ❌ High customer concentration (>30%)
- ❌ Owner-operator dependent
- ❌ Major red flags present`;

// =============================================================================
// STRUCTURED OUTPUT SCHEMAS
// =============================================================================

/**
 * Schema for structured criteria extraction
 * Used by AI tool calling to ensure consistent output format
 */
export interface ExtractedCriteriaSchema {
  size_criteria: {
    min_revenue?: number;  // In millions
    max_revenue?: number;
    min_ebitda?: number;  // In millions
    max_ebitda?: number;
    min_locations?: number;
    max_locations?: number;
    min_employees?: number;
    revenue_per_location_min?: number;
  };
  service_criteria: {
    primary_focus: string[];  // CRITICAL: Array of primary service keywords
    preferred_services: string[];
    excluded_services: string[];
    business_model?: string;
    recurring_revenue_min?: number;  // As percentage
  };
  geography_criteria: {
    required_regions: string[];
    preferred_regions: string[];
    excluded_regions: string[];
    priority_metros: string[];
    min_market_population?: number;
  };
  buyer_types_criteria: {
    buyer_types: BuyerTypeSchema[];
  };
}

export interface BuyerTypeSchema {
  type_name: string;
  priority_order: number;
  description?: string;
  ownership_profile?: string;
  min_ebitda?: number;
  max_ebitda?: number;
  min_locations?: number;
  max_locations?: number;
  geographic_scope?: string;
  acquisition_style?: string;
  exclusions?: string[];
}

// =============================================================================
// PHASE DEFINITIONS
// =============================================================================

export const PHASE_PROMPTS = {
  phase1: {
    name: "Industry Fundamentals",
    instruction: `Generate PART 1 of the M&A Industry Guide. This is INDUSTRY FUNDAMENTALS.

Include ALL of the following with DEEP, RESEARCHED content:

## 1. INDUSTRY DEFINITION & SCOPE
- NAICS Code (actual 6-digit code)
- What's included and excluded
- Key subsegments with characteristics

## 2. INDUSTRY TERMINOLOGY & LANGUAGE
- Business types with examples
- Key operational metrics (KPIs) with SPECIFIC BENCHMARKS

## 3. BUSINESS MODELS & HOW COMPANIES MAKE MONEY
- Service delivery models
- Revenue models with valuation impact
- Customer segment models

## 4. INDUSTRY ECOSYSTEM & STAKEHOLDERS
- Customers, payers, suppliers, referral sources
- Regulators and compliance requirements

## 5. INDUSTRY ECONOMICS & UNIT ECONOMICS
- Revenue drivers
- Cost structure with SPECIFIC PERCENTAGES
- Economies of scale

## 6. MARKET SEGMENTS & COMPETITIVE LANDSCAPE
- Consolidation status
- Barriers to entry
- Geographic considerations

USE TABLES with real data. Target: 8,000-12,000 words.`,
    expectedSections: [
      "INDUSTRY DEFINITION & SCOPE",
      "INDUSTRY TERMINOLOGY & LANGUAGE", 
      "BUSINESS MODELS",
      "INDUSTRY ECOSYSTEM",
      "INDUSTRY ECONOMICS",
      "MARKET SEGMENTS"
    ],
    targetWordCount: 8000
  },
  
  phase2: {
    name: "Acquisition Attractiveness",
    instruction: `Generate PART 2: ACQUISITION ATTRACTIVENESS.

Include ALL sections with SPECIFIC benchmarks:

## 7. FINANCIAL ATTRACTIVENESS
- EBITDA size categories with specific thresholds
- EBITDA margin benchmarks (specific percentages)
- Revenue concentration thresholds
- Revenue growth expectations

## 8. OPERATIONAL ATTRACTIVENESS
- TOP 5-7 KPIs with SPECIFIC BENCHMARKS
- Operational strengths that create value
- Operational weaknesses that destroy value

## 9. STRATEGIC ATTRACTIVENESS
- Geographic factors (high-value markets)
- Competitive advantages/moats
- Key certifications and licenses

## 10. DEAL KILLERS & RED FLAGS
- Financial red flags with thresholds
- Operational red flags
- Legal/regulatory red flags

Target: 10,000-14,000 words.`,
    expectedSections: [
      "FINANCIAL ATTRACTIVENESS",
      "OPERATIONAL ATTRACTIVENESS",
      "STRATEGIC ATTRACTIVENESS", 
      "DEAL KILLERS & RED FLAGS"
    ],
    targetWordCount: 10000
  },
  
  phase3: {
    name: "Application & Buyer Fit",
    instruction: `Generate PART 3: APPLICATION & BUYER FIT.

## 11. SELLER EVALUATION FRAMEWORK
- Financial Assessment Scorecard with weights
- Operational Assessment Scorecard with industry KPIs
- Strategic Assessment Scorecard

## 12. BUYER MATCHING CRITERIA
### SIZE CRITERIA
- Minimum/preferred revenue
- Minimum/preferred EBITDA
- Location count preferences

### SERVICE CRITERIA
**Primary Focus Services (REQUIRED - deals must have):**
- [List 3-5 primary services]

**Preferred Services (bonus):**
- [List preferred services]

**Excluded Services (avoid):**
- [List excluded services]

### GEOGRAPHY CRITERIA
- Target regions with states
- Priority metros (15+ cities)
- Regions to avoid

### BUYER TYPES (in priority order)
1. Large National Platforms
2. Regional Platforms
3. Emerging Platforms
4. Strategic Acquirers
5. Individual/Search Funds

## 13. VALUATION BENCHMARKS

## BUYER FIT CRITERIA SUMMARY

Target: 8,000-10,000 words.`,
    expectedSections: [
      "SELLER EVALUATION FRAMEWORK",
      "BUYER MATCHING CRITERIA",
      "VALUATION BENCHMARKS",
      "BUYER FIT CRITERIA SUMMARY"
    ],
    targetWordCount: 8000
  }
};

// =============================================================================
// EXPECTED SECTIONS FOR VALIDATION
// =============================================================================

export const EXPECTED_SECTIONS = [
  // Part 1 - Industry Fundamentals
  "INDUSTRY DEFINITION",
  "NAICS",
  "SUBSEGMENT",
  "TERMINOLOGY",
  "BUSINESS MODEL",
  "REVENUE MODEL",
  "ECOSYSTEM",
  "ECONOMICS",
  "CONSOLIDATION",
  "COMPETITIVE",
  
  // Part 2 - Acquisition Attractiveness  
  "FINANCIAL ATTRACTIVENESS",
  "EBITDA",
  "MARGIN",
  "CONCENTRATION",
  "OPERATIONAL ATTRACTIVENESS",
  "KPI",
  "STRATEGIC ATTRACTIVENESS",
  "CERTIFICATION",
  "DEAL KILLER",
  "RED FLAG",
  
  // Part 3 - Application
  "EVALUATION",
  "SCORECARD",
  "BUYER MATCHING",
  "SIZE CRITERIA",
  "SERVICE CRITERIA",
  "GEOGRAPHY CRITERIA",
  "BUYER TYPES",
  "VALUATION",
  "PRIMARY_FOCUS"
];

// =============================================================================
// QUALITY THRESHOLDS
// =============================================================================

export const QUALITY_THRESHOLDS = {
  minWordCount: 25000,
  minTables: 15,
  minSectionsFound: 20,
  maxPlaceholders: 10,
  minIndustryMentions: 30,
  requiredElements: [
    "NAICS",
    "EBITDA",
    "KPI",
    "VALUATION",
    "SIZE CRITERIA",
    "SERVICE CRITERIA", 
    "GEOGRAPHY CRITERIA",
    "BUYER TYPES",
    "PRIMARY_FOCUS"
  ]
};

// =============================================================================
// CRITERIA FIELD MAPPINGS
// =============================================================================

/**
 * Maps extracted criteria fields to database schema
 * Used to ensure consistency between generation, extraction, and scoring
 */
export const CRITERIA_FIELD_MAPPINGS = {
  // Size criteria fields
  size: {
    min_revenue: 'size_criteria.min_revenue',
    max_revenue: 'size_criteria.max_revenue',
    min_ebitda: 'size_criteria.min_ebitda',
    max_ebitda: 'size_criteria.max_ebitda',
    min_locations: 'size_criteria.min_locations',
    max_locations: 'size_criteria.max_locations',
  },
  // Service criteria fields - CRITICAL for scoring
  service: {
    primary_focus: 'service_criteria.primary_focus',  // Array of service keywords
    preferred_services: 'service_criteria.preferred_services',
    excluded_services: 'service_criteria.excluded_services',
    business_model: 'service_criteria.business_model',
  },
  // Geography criteria fields
  geography: {
    required_regions: 'geography_criteria.required_regions',
    preferred_regions: 'geography_criteria.preferred_regions',
    excluded_regions: 'geography_criteria.excluded_regions',
    priority_metros: 'geography_criteria.priority_metros',
  },
  // Buyer types fields
  buyer_types: {
    buyer_types: 'buyer_types_criteria.buyer_types',
  }
};
